---
title: "Group 6 R Project"
author: "Beau Barber"
date: "9/18/2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Install tidytuesday package
```{r}
install.packages("tidytuesdayR", repos = "http://cran.us.r-project.org")
```



#Pull Data

```{r}
rainfall <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/rainfall.csv')
temperature <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-07/temperature.csv')


head(rainfall)
head(temperature)
```
## Load all necessary libraries
Be sure to install these packages on your computer if you have never done so before (ex: install.packages("lsmeans"))
```{r}
library(lmerTest)
library(lsmeans)
library(multcomp)
library(multcompView)
library(tidyverse)
library(lawstat)
library(doBy)
```

Add a column to rainfall data so the date is all in one column
```{r}
rainfall$date <- as.Date(paste(rainfall$year,"-",rainfall$month,"-",rainfall$day, sep = ""))


rainfall %>%
  dplyr::mutate(thisvariable = lat+long) %>% ###NOTE TO SELF THAT I FORGOT. MUTATATE IS ONLY TEMPORARY UNLESS YOU EXPLICITLY SAVE OUTPUT
  arrange(rainfall)
```

Filter the rainfall and temperature data so we are only working with variables from Jan 2008 to Dec 2018
```{r}
temperature$city_name <- gsub("BRISBANE","Brisbane", temperature$city_name)
temperature$city_name <- gsub("CANBERRA","Canberra", temperature$city_name)
temperature$city_name <- gsub("MELBOURNE","Melbourne", temperature$city_name)
temperature$city_name <- gsub("PERTH","Perth", temperature$city_name)
temperature$city_name <- gsub("SYDNEY","Sydney", temperature$city_name)

rainfall_1 <- rainfall %>% filter(date >= "1967-01-01", 
                                 date <= "2018-12-31")

rainfall_2 <- rainfall_1 %>% filter(city_name == "Brisbane" | city_name == "Canberra" | city_name == "Melbourne" | city_name == "Perth" | city_name == "Sydney")


temp_1 <- temperature %>% filter(date >= "1967-01-01", 
                                 date <= "2018-12-31")
#I think this can be piped 
temp_2 <- temp_1 %>% filter(city_name == "Brisbane" | city_name == "Canberra" | city_name == "Melbourne" | city_name == "Perth" | city_name == "Sydney")

```


```{r}
combined <- merge(rainfall_2, temp_2, by = c("city_name", "date"))
head(combined)
```

The ~ variables return the measurements by all combinations of var1 + var2, e.g. var1_1+var2_1, var1_2+var2_1, var1_1+var2_2, var1_2+var2_2. So, for individual variables where you want the measurements across all levels of the others, keep them separate.

```{r}

summaryBy(temperature ~ temp_type + city_name, data = combined,
  FUN = function(x) { c(average = mean(x, na.rm = T), standard_deviation = sd(x, na.rm = T), maximum = max(x, na.rm = T), minimum = min(x, na.rm = T)) } )

summaryBy(rainfall ~ city_name, data = combined,
  FUN = function(x) { c(average = mean(x, na.rm = T), standard_deviation = sd(x, na.rm = T), maximum = max(x, na.rm = T), minimum = min(x, na.rm = T)) } )

summaryBy(rainfall ~ month, data = combined,
  FUN = function(x) { c(average = mean(x, na.rm = T), standard_deviation = sd(x, na.rm = T), maximum = max(x, na.rm = T), minimum = min(x, na.rm = T)) } )

summaryBy(temperature ~ month + temp_type, data = combined,
  FUN = function(x) { c(average = mean(x, na.rm = T), standard_deviation = sd(x, na.rm = T), maximum = max(x, na.rm = T), minimum = min(x, na.rm = T)) } )

summaryBy(rainfall ~ year, data = combined,
  FUN = function(x) { c(average = mean(x, na.rm = T), standard_deviation = sd(x, na.rm = T), maximum = max(x, na.rm = T), minimum = min(x, na.rm = T)) } )

summaryBy(temperature ~ year + temp_type, data = combined,
  FUN = function(x) { c(average = mean(x, na.rm = T), standard_deviation = sd(x, na.rm = T), maximum = max(x, na.rm = T), minimum = min(x, na.rm = T)) } )


```

___Max and Min made into their own columns with temperature values and charting both rainfall and temperature values monthly___
```{r}
library(ggplot2)
library(dplyr)
library(patchwork)

combined$date_2 <- as.Date(paste(combined$year,"-",combined$month,"-",1, sep = "")) #makes charting the dates by month easier
combined$date_3 <- as.Date(paste(combined$year,"-",1,"-",1, sep = ""))#makes charting the dates by month easier
```


```{r}
combined_wider <- pivot_wider(data=combined, names_from = temp_type, values_from = temperature)
names(combined_wider)[names(combined_wider) == "max"] <- "max_temperature"
names(combined_wider)[names(combined_wider) == "min"] <- "min_temperature"


combined_avg_rt <- aggregate(. ~city_name+date_2,data = combined_wider[, c("rainfall","max_temperature","min_temperature","city_name","date_2")], mean)

p1<-ggplot(data = combined_avg_rt) +
  geom_point(mapping = aes(y = rainfall, x = date_2),size=0.5, colour="blue")+
  geom_point(mapping = aes(y=min_temperature/1.5, x = date_2),size=0.001,alpha=0.75, colour="red") +
  geom_point(mapping = aes(y=max_temperature/1.5, x = date_2),size=0.001,alpha=0.75, colour="black") +
  scale_y_continuous(name = ("Rainfall (blue)"), sec.axis = sec_axis(~.*1.5,name="Temperature (Max=black, Min=red)"))+
  facet_grid(rows = vars(city_name))+
  scale_x_date(date_breaks = "years" , date_labels = "%Y")+
labs(x="Year",title = "Average Monthly Rainfall and Max/Min Temperatures")
p1+theme(axis.text.x = element_text(angle = 90))

```

Normality and HOV Tests of Data
```{r}
install.packages("olsrr")
install.packages("onewaytests")
```

ANOVA
```{r}
library(olsrr)
library(onewaytests)

#To use date, need to use as.numeric(date) 
### RAINFALL BY MONTH
# Normality Test: Shapiro-Wilks
combined_wider$month <- as.factor(combined_wider$month) #had to coerce to a factor
combined_wider$year <- as.factor(combined_wider$year) #had to coerce to a factor
combined_wider$city_name <- as.factor(combined_wider$city_name) #had to coerce to a factor

sydney_temp_rainfall <- combined_wider %>%
  filter(city_name == "Sydney") %>%
  mutate(id=row_number()) %>%
  filter(id %% ceiling(max(c(id))/5000)  == 1)   #n() when used in dpylr is the "count number of observations in the current group
model <- lm(rainfall ~ city_name, sydney_and_perth)
ols_plot_resid_qq(model)
ols_test_normality(model)

#HOV Test: Brown-Forsythe test
res <- bf.test(rainfall ~ month, data = sydney_only_reduced)

sydney_only <- combined_wider[combined_wider$city_name == "Perth",]
sydney_only_reduced <- sydney_only[seq(1,length(syndey_only$min),by=8),] # lm can only accept up to 5000 observations
model <- lm(rainfall ~ month, sydney_only_reduced)
ols_plot_resid_qq(model)
ols_test_normality(model)

#HOV Test: Brown-Forsythe test
res <- bf.test(rainfall ~ month, data = sydney_only_reduced)
#res

#res <- var.test(rainfall ~ year, data = sydney_only_reduced) #doesn't work because factors have more than 2 levles
#res

#Anova table
anova(model)




### MAX TEMP BY MONTH
# Normality Test: Shapiro-Wilks
#sydney_only <- combined_wider[combined_wider$city_name == "Sydney",]
sydney_only_reduced <- sydney_only[seq(1,length(syndey_only$min),by=8),]
model <- lm(max ~ month, sydney_only_reduced)
ols_plot_resid_qq(model)
ols_test_normality(model)

#HOV Test: Brown-Forsythe test
res <- bf.test(max ~ month, data = sydney_only_reduced)

#Anova table
anova(model)




### MIN TEMP BY MONTH
# Normality Test: Shapiro-Wilks
sydney_only_reduced <- sydney_only[seq(1,length(syndey_only$min),by=8),]
model <- lm(min ~ month, sydney_only_reduced)
ols_plot_resid_qq(model)
ols_test_normality(model)

#HOV Test: Brown-Forsythe test
res <- bf.test(min ~ month, data = sydney_only_reduced)

#Anova table
anova_table<-anova(model)
```

___Simple One-Way Analysis of Variance ANOVA___ combined this with above??? or remove this???? 
```{r}
#### General format is:   fit <- aov(y ~ A, data=mydataframe) where y and A are variables in the mydataframe

#ANOVA temperature and temp_type+city_name
aov_temp_type_city <- aov(temperature ~ temp_type + city_name, data = combined)
print(summary(aov_temp_type_city))
cat("\n-------------------------------\n")

#ANOVA rainfall and city_name
aov_rainfall_city <- aov(rainfall ~ city_name, data = combined)
print(summary(aov_rainfall_city))
cat("\n-------------------------------\n")

#ANOVA rainfall and month
aov_rainfall_month <- aov(rainfall ~ month, data = combined)
print(summary(aov_rainfall_month))
cat("\n-------------------------------\n")

#ANOVA temperature and temp_type+month
aov_temp_type_month <- aov(temperature ~ temp_type + month, data = combined)
print(summary(aov_temp_type_month))
cat("\n-------------------------------\n")

#ANOVA rainfall and year
aov_rainfall_year <- aov(rainfall ~ year, data = combined)
print(summary(aov_rainfall_year))

#ANOVA temperature and temp_type+year
aov_temp_type_year <- aov(temperature ~ temp_type + year, data = combined)
print(summary(aov_temp_type_year))
cat("\n-------------------------------\n")
```

What graphs do we want to keep from here?
```{r}
library(ggplot2)
ggplot(data = combined) +
  geom_point(mapping = aes(x = temperature, y = rainfall, color = temp_type))
  #facet_grid(city_name~year)

ggplot(data = combined) +
  geom_col(mapping = aes(x = year, y = rainfall))

ggplot(data = combined) +
  geom_col(mapping = aes(x = year, y = temperature, color = temp_type))

ggplot(data = combined) +
  geom_col(mapping = aes(x = month, y = rainfall))

ggplot(data = combined) +
  geom_col(mapping = aes(x = month, y = temperature, color = temp_type))

ggplot(data = combined) +
  geom_col(mapping = aes(x = city_name, y = rainfall))
  #facet_grid(~year)

ggplot(data = combined) +
  geom_col(mapping = aes(x = month, y = temperature, color = temp_type))
  #facet_grid(~city_name)

```






